question_id,title,description,required_fields,difficulty,category,reference_sql_pg,reference_sql_mysql,instance_tags,hints,status
QPG001,客户公司与国家,列出所有客户的公司名与国家,"company_name,country",beginner,filtering,"SELECT company_name, country FROM customers ORDER BY company_name","","pg_default","基本筛选;按公司名排序",published
QPG002,德国客户数量,统计来自德国的客户数量,customer_count,beginner,aggregation,"SELECT COUNT(*) AS customer_count FROM customers WHERE country = 'Germany'","","pg_default","COUNT 聚合;简单条件过滤",published
QPG003,最贵商品前五,列出单价最高的前5个商品及单价,"product_name,unit_price",beginner,sorting,"SELECT product_name, unit_price FROM products ORDER BY unit_price DESC LIMIT 5","","pg_default","ORDER BY + LIMIT;降序排列",published
QPG004,缺货商品,列出库存为0的商品,"product_id,product_name",beginner,filtering,"SELECT product_id, product_name FROM products WHERE units_in_stock = 0 ORDER BY product_id","","pg_default","等值过滤;选择列",published
QPG005,饮料类商品,列出类别为“Beverages”的所有商品,"product_id,product_name,category_name",beginner,joins,"SELECT p.product_id, p.product_name, c.category_name FROM products p JOIN categories c ON p.category_id = c.category_id WHERE c.category_name = 'Beverages' ORDER BY p.product_id","","pg_default","内连接;维表过滤",published
QPG006,发往国家列表,列出订单中所有不同的发货国家,ship_country,beginner,distinct,"SELECT DISTINCT ship_country FROM orders ORDER BY ship_country","","pg_default","DISTINCT 去重;排序",published
QPG007,每类商品数量,统计每个类别下的商品数量,"category_name,product_count",beginner,aggregation,"SELECT c.category_name, COUNT(*) AS product_count FROM products p JOIN categories c ON p.category_id = c.category_id GROUP BY c.category_name ORDER BY product_count DESC","","pg_default","GROUP BY;计数",published
QPG008,1997年订单数,统计1997年创建的订单数量,order_count,beginner,date-time,"SELECT COUNT(*) AS order_count FROM orders WHERE EXTRACT(YEAR FROM order_date) = 1997","","pg_default","EXTRACT 年份;按年过滤",published
QPG009,客户数最多的国家TOP5,按国家统计客户数量并取前5,"country,customer_count",beginner,aggregation,"SELECT country, COUNT(*) AS customer_count FROM customers GROUP BY country ORDER BY customer_count DESC, country ASC LIMIT 5","","pg_default","分组聚合;多列排序",published
QPG010,高运费订单,列出运费大于100的订单号与运费,"order_id,freight",beginner,filtering,"SELECT order_id, freight FROM orders WHERE freight > 100 ORDER BY freight DESC, order_id ASC","","pg_default","比较运算;多关键字排序",published
QPG011,客户订单数量TOP10,统计每个客户的订单数量并取前10,"customer_id,company_name,order_count",intermediate,joins,"SELECT c.customer_id, c.company_name, COUNT(o.order_id) AS order_count FROM customers c LEFT JOIN orders o ON o.customer_id = c.customer_id GROUP BY c.customer_id, c.company_name ORDER BY order_count DESC, c.customer_id ASC LIMIT 10","","pg_default","左连接;分组计数;TOPN",published
QPG012,员工处理订单数,统计每位员工处理的订单数量,"employee_id,last_name,first_name,order_count",intermediate,joins,"SELECT e.employee_id, e.last_name, e.first_name, COUNT(o.order_id) AS order_count FROM employees e LEFT JOIN orders o ON o.employee_id = e.employee_id GROUP BY e.employee_id, e.last_name, e.first_name ORDER BY order_count DESC, e.employee_id ASC","","pg_default","维表连接;分组聚合",published
QPG013,商品销售额TOP10,按订单明细计算每个商品的总销售额并取前10,"product_id,product_name,total_sales",intermediate,aggregation,"SELECT p.product_id, p.product_name, SUM(od.unit_price * od.quantity * (1 - od.discount)) AS total_sales FROM products p JOIN order_details od ON od.product_id = p.product_id GROUP BY p.product_id, p.product_name ORDER BY total_sales DESC NULLS LAST LIMIT 10","","pg_default","金额聚合;折扣处理",published
QPG014,各国平均发货延迟,计算各发货国家平均发货延迟(天),"ship_country,avg_delay_days",intermediate,date-time,"SELECT ship_country, AVG(shipped_date - order_date) AS avg_delay_days FROM orders WHERE shipped_date IS NOT NULL AND order_date IS NOT NULL GROUP BY ship_country ORDER BY avg_delay_days DESC NULLS LAST","","pg_default","日期差;平均值",published
QPG015,年度订单数,统计每年订单数量,"year,order_count",intermediate,date-time,"SELECT CAST(date_part('year', order_date) AS INT) AS year, COUNT(*) AS order_count FROM orders GROUP BY CAST(date_part('year', order_date) AS INT) ORDER BY year","","pg_default","date_part;年度分组",published
QPG016,从未被订购的商品,找出从未出现在订单明细里的商品,"product_id,product_name",intermediate,anti-join,"SELECT p.product_id, p.product_name FROM products p LEFT JOIN order_details od ON od.product_id = p.product_id WHERE od.product_id IS NULL ORDER BY p.product_id","","pg_default","反连接模式;NULL 过滤",published
QPG017,类别平均单价,计算每个类别的平均商品单价,"category_name,avg_price",intermediate,aggregation,"SELECT c.category_name, AVG(p.unit_price) AS avg_price FROM products p JOIN categories c ON c.category_id = p.category_id GROUP BY c.category_name ORDER BY avg_price DESC NULLS LAST","","pg_default","AVG 聚合;维度分组",published
QPG018,折扣订单占比,统计有折扣(>0)的订单数量及占比,"discounted_order_count,percentage",intermediate,aggregation,"WITH a AS (SELECT COUNT(DISTINCT order_id) AS total_orders FROM order_details), b AS (SELECT COUNT(DISTINCT order_id) AS discounted_order_count FROM order_details WHERE discount > 0) SELECT b.discounted_order_count, ROUND(100.0 * b.discounted_order_count / NULLIF(a.total_orders,0), 2) AS percentage FROM a, b","","pg_default","去重计数;占比计算",published
QPG019,客户最近下单日期,查询每位客户最近一次下单日期,"customer_id,company_name,last_order_date",intermediate,aggregation,"SELECT c.customer_id, c.company_name, MAX(o.order_date) AS last_order_date FROM customers c LEFT JOIN orders o ON o.customer_id = c.customer_id GROUP BY c.customer_id, c.company_name ORDER BY last_order_date DESC NULLS LAST","","pg_default","MAX 聚合;左连接",published
QPG020,供应商销售额TOP5,统计各供应商的总销售额并取前5,"supplier_id,company_name,total_sales",intermediate,aggregation,"SELECT s.supplier_id, s.company_name, SUM(od.unit_price * od.quantity * (1 - od.discount)) AS total_sales FROM suppliers s JOIN products p ON p.supplier_id = s.supplier_id JOIN order_details od ON od.product_id = p.product_id GROUP BY s.supplier_id, s.company_name ORDER BY total_sales DESC NULLS LAST LIMIT 5","","pg_default","多表连接;金额聚合",published
QPG021,各国内客户销售额排名TOP3,每个国家内按客户总销售额排名取前3,"country,customer_id,company_name,total_sales,rank",advanced,window,"WITH sales AS ( SELECT c.country, c.customer_id, c.company_name, SUM(od.unit_price * od.quantity * (1 - od.discount)) AS total_sales FROM customers c JOIN orders o ON o.customer_id = c.customer_id JOIN order_details od ON od.order_id = o.order_id GROUP BY c.country, c.customer_id, c.company_name ), ranked AS ( SELECT country, customer_id, company_name, total_sales, RANK() OVER (PARTITION BY country ORDER BY total_sales DESC) AS rnk FROM sales ) SELECT country, customer_id, company_name, total_sales, rnk AS rank FROM ranked WHERE total_sales IS NOT NULL AND rnk <= 3","","pg_default","窗口函数 RANK;分组排名",published
QPG022,月度订单移动平均,计算每月订单数及3个月移动平均,"month,order_count,ma3",advanced,window,"WITH m AS ( SELECT date_trunc('month', order_date)::date AS month, COUNT(*) AS order_count FROM orders GROUP BY 1 ) SELECT month, order_count, ROUND(AVG(order_count) OVER (ORDER BY month ROWS BETWEEN 2 PRECEDING AND CURRENT ROW),2) AS ma3 FROM m ORDER BY month","","pg_default","date_trunc(月);窗口平均",published
QPG023,发货超10天订单占比(年),按年份计算发货延迟>10天的订单占比,"year,late_ratio",advanced,date-time,"WITH base AS ( SELECT date_part('year', order_date)::int AS year, COUNT(*) AS total_cnt, SUM(CASE WHEN shipped_date IS NOT NULL AND shipped_date - order_date > 10 THEN 1 ELSE 0 END) AS late_cnt FROM orders WHERE order_date IS NOT NULL GROUP BY 1 ) SELECT year, ROUND(100.0 * late_cnt / NULLIF(total_cnt,0),2) AS late_ratio FROM base ORDER BY year","","pg_default","CASE 条件聚合;比率",published
QPG024,一年未复购客户,识别距离全局最近下单日期超过一年未下单的客户,"customer_id,company_name,last_order_date",advanced,subquery,"WITH latest AS (SELECT MAX(order_date) AS max_date FROM orders), cust AS ( SELECT c.customer_id, c.company_name, MAX(o.order_date) AS last_order_date FROM customers c LEFT JOIN orders o ON o.customer_id = c.customer_id GROUP BY c.customer_id, c.company_name ) SELECT customer_id, company_name, last_order_date FROM cust, latest WHERE last_order_date IS NOT NULL AND last_order_date < (latest.max_date - INTERVAL '365 days') ORDER BY last_order_date","","pg_default","子查询;相对时间窗口",published
QPG025,员工累计订单数,按时间为每位员工计算累计订单数,"employee_id,order_date,order_count_running",advanced,window,"WITH eo AS ( SELECT employee_id, order_date, COUNT(*) AS order_cnt FROM orders WHERE employee_id IS NOT NULL AND order_date IS NOT NULL GROUP BY employee_id, order_date ) SELECT employee_id, order_date, SUM(order_cnt) OVER (PARTITION BY employee_id ORDER BY order_date ROWS UNBOUNDED PRECEDING) AS order_count_running FROM eo ORDER BY employee_id, order_date","","pg_default","累计和窗口;分区排序",published
QPG026,类别内高于全局均价的商品,列出单价高于全局平均单价的商品,"product_id,product_name,unit_price,category_name",advanced,subquery,"SELECT p.product_id, p.product_name, p.unit_price, c.category_name FROM products p JOIN categories c ON c.category_id = p.category_id WHERE p.unit_price > (SELECT AVG(unit_price) FROM products) ORDER BY p.unit_price DESC","","pg_default","标量子查询;全局平均",published
QPG027,区域与订单统计,统计每个大区的员工人数与订单数量,"region_description,employee_count,order_count",advanced,joins,"SELECT r.region_description, COUNT(DISTINCT e.employee_id) AS employee_count, COUNT(o.order_id) AS order_count FROM region r JOIN territories t ON t.region_id = r.region_id JOIN employee_territories et ON et.territory_id = t.territory_id JOIN employees e ON e.employee_id = et.employee_id LEFT JOIN orders o ON o.employee_id = e.employee_id GROUP BY r.region_description ORDER BY employee_count DESC","","pg_default","多表连接;DISTINCT 计数",published
QPG028,客户平均复购间隔,计算每位客户相邻两单的平均间隔天数,"customer_id,company_name,avg_gap_days",advanced,window,"WITH o AS ( SELECT c.customer_id, c.company_name, o.order_date, LAG(o.order_date) OVER (PARTITION BY c.customer_id ORDER BY o.order_date) AS prev_order_date FROM customers c JOIN orders o ON o.customer_id = c.customer_id ), d AS ( SELECT customer_id, company_name, (order_date - prev_order_date) AS gap_days FROM o WHERE prev_order_date IS NOT NULL ) SELECT customer_id, company_name, ROUND(AVG(gap_days),2) AS avg_gap_days FROM d GROUP BY customer_id, company_name ORDER BY avg_gap_days","","pg_default","LAG;日期差;平均",published
QPG029,高频共购商品对TOP10,找出同一订单中最常一起出现的商品对,"product_id_a,product_id_b,together_count",advanced,joins,"SELECT od1.product_id AS product_id_a, od2.product_id AS product_id_b, COUNT(*) AS together_count FROM order_details od1 JOIN order_details od2 ON od1.order_id = od2.order_id AND od1.product_id < od2.product_id GROUP BY od1.product_id, od2.product_id ORDER BY together_count DESC LIMIT 10","","pg_default","自连接;组合计数",published
QPG030,每月新客户数,统计每月的首单客户数量,"month,new_customers",advanced,date-time,"WITH first_orders AS ( SELECT o.customer_id, MIN(o.order_date) AS first_order_date FROM orders o GROUP BY o.customer_id ), m AS ( SELECT date_trunc('month', first_order_date)::date AS month, COUNT(*) AS new_customers FROM first_orders GROUP BY 1 ) SELECT month, new_customers FROM m ORDER BY month","","pg_default","首单识别;按月统计",published
